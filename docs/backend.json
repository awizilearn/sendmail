{
  "entities": {
    "Recipient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recipient",
      "type": "object",
      "description": "Represents a recipient of an email, extracted from the Excel data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recipient."
        },
        "emailAddress": {
          "type": "string",
          "description": "Email address of the recipient.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the recipient."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the recipient."
        },
        "civility": {
          "type": "string",
          "description": "Civility of the recipient (e.g., Monsieur, Madame)."
        }
      },
      "required": [
        "id",
        "emailAddress",
        "firstName",
        "lastName"
      ]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents an appointment or event associated with a recipient.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the appointment."
        },
        "recipientId": {
          "type": "string",
          "description": "Reference to Recipient. (Relationship: Recipient 1:N Appointment)"
        },
        "appointmentType": {
          "type": "string",
          "description": "Type of appointment (e.g., SUIVI DIHS, LIKE FORMATION)."
        },
        "appointmentDateTime": {
          "type": "string",
          "description": "Date and time of the appointment.",
          "format": "date-time"
        },
        "platform": {
          "type": "string",
          "description": "The platform that the training will be on"
        },
        "statusMail": {
          "type": "string",
          "description": "The status of the email"
        }
      },
      "required": [
        "id",
        "recipientId",
        "appointmentDateTime"
      ]
    },
    "Trainer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Trainer",
      "type": "object",
      "description": "Represents a trainer associated with an appointment",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the trainer."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the trainer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the trainer."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName"
      ]
    },
    "EmailLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EmailLog",
      "type": "object",
      "description": "Represents a log of sent emails.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the email log entry."
        },
        "recipientId": {
          "type": "string",
          "description": "Reference to Recipient. (Relationship: Recipient 1:N EmailLog)"
        },
        "appointmentId": {
          "type": "string",
          "description": "Reference to Appointment. (Relationship: Appointment 1:N EmailLog)"
        },
        "sentDateTime": {
          "type": "string",
          "description": "Date and time the email was sent.",
          "format": "date-time"
        },
        "emailContent": {
          "type": "string",
          "description": "Content of the email sent."
        },
        "status": {
          "type": "string",
          "description": "Status of the email sending process (e.g., sent, failed)."
        }
      },
      "required": [
        "id",
        "recipientId",
        "sentDateTime",
        "emailContent",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/recipients/{recipientId}",
        "definition": {
          "entityName": "Recipient",
          "schema": {
            "$ref": "#/backend/entities/Recipient"
          },
          "description": "Stores recipient information. Path-based ownership ensures only the user can access their recipients.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the authenticated user."
            },
            {
              "name": "recipientId",
              "description": "The unique ID of the recipient."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recipients/{recipientId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointment information for a specific recipient. Path-based ownership ensures only the user can access their recipient's appointments.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the authenticated user."
            },
            {
              "name": "recipientId",
              "description": "The unique ID of the recipient."
            },
            {
              "name": "appointmentId",
              "description": "The unique ID of the appointment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recipients/{recipientId}/emailLogs/{emailLogId}",
        "definition": {
          "entityName": "EmailLog",
          "schema": {
            "$ref": "#/backend/entities/EmailLog"
          },
          "description": "Stores email log information for a specific recipient. Path-based ownership ensures only the user can access their recipient's email logs.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the authenticated user."
            },
            {
              "name": "recipientId",
              "description": "The unique ID of the recipient."
            },
            {
              "name": "emailLogId",
              "description": "The unique ID of the email log."
            }
          ]
        }
      },
      {
        "path": "/trainers/{trainerId}",
        "definition": {
          "entityName": "Trainer",
          "schema": {
            "$ref": "#/backend/entities/Trainer"
          },
          "description": "Stores information about trainers. Publicly accessible.",
          "params": [
            {
              "name": "trainerId",
              "description": "The unique ID of the trainer."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Mail Pilot application's requirements, focusing on secure data access, scalability, and ease of debugging. The primary goal is to facilitate the efficient import of Excel data, personalized email composition, and email sending, all while maintaining a clear and secure authorization model.\n\n**Authorization Independence:** The structure prioritizes authorization independence to enable atomic operations and simplify security rules.  This is primarily achieved through path-based ownership for Recipients and their associated data (Appointments, EmailLogs).\n\n**Structural Segregation:** Data with different access requirements is segregated into separate collections, simplifying security rules and ensuring that each collection has a homogeneous security posture.  For example, recipient-specific data is stored under the `/users/{userId}` path.\n\n**Access Modeling:**\n*   **Private User Data:** Uses path-based ownership for user-related data. Recipients and their related Appointments and EmailLogs are stored under `/users/{userId}`, making security rules straightforward. The system relies solely on `request.auth.uid`.\n*   **QAPs (Rules Are Not Filters):** The structure enables secure `list` operations by using path-based ownership. Listing recipients, appointments, or email logs can be done securely by scoping the query to the current user's path (`/users/{userId}`).\n\n**Data Clarity and Predictability:** The structure enforces clear naming conventions and explicit state modeling to improve debuggability and maintainability. Field names are semantic, and wildcards are descriptive."
  }
}