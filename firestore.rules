rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ------------------------------------------------------------------------
    // Helper Functions
    // ------------------------------------------------------------------------

    /**
     * Checks if the user is authenticated.
     */
    function isSignedIn() {
      return request.auth != null;
    }
    
    // ------------------------------------------------------------------------
    // Public Data Rules
    // ------------------------------------------------------------------------
    
    /**
     * @description Controls access to the public collection of trainers.
     * @path /trainers/{trainerId}
     * @allow Any user, including unauthenticated ones, can (get) a trainer's document at `/trainers/trainer_123`.
     * @deny Any user, including authenticated ones, cannot (create) a new trainer document. This must be done via a backend admin SDK.
     * @principle Allows public read access for globally shared data while denying all client-side writes to maintain data integrity.
     */
    match /trainers/{trainerId} {
      allow get: if true;
      allow list: if true;
      // CRITICAL: Cannot implement owner-only writes. The 'Trainer' entity is missing an 'ownerId' or 'authorId' field.
      // Disabling all client-side writes is the most secure default. Manage this data with a trusted backend service.
      allow create: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
      allow update: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
      allow delete: if false; // TODO: Add owner validation once the schema is updated with an ownership field.
    }
  }
}
